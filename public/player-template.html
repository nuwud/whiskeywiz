<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiskey Challenge - Player</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Whiskey Challenge</h1>
    <div>
        <label for="quarter-select">Select Quarter:</label>
        <select id="quarter-select">
            <option value="">Select a quarter</option>
        </select>
    </div>
    <div id="game-container"></div>
    <button id="submit-answers" type="submit">Submit Guesses</button>
    <div id="result-container">
        <h2>Results</h2>
        <div id="results"></div>
    </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/13.18.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/13.18.0/firebase-firestore.js";

        // Your Firebase configuration (you can replace these dynamically)
        const firebaseConfig = {
            apiKey: "AIzaSyCqZMaGpJGf5veYgTXmytg1bLerva-of0U",
            authDomain: "whiskeywiz2.firebaseapp.com",
            databaseURL: "https://whiskeywiz2-default-rtdb.firebaseio.com",
            projectId: "whiskeywiz2",
            storageBucket: "whiskeywiz2.appspot.com",
            messagingSenderId: "555320797929",
            appId: "1:555320797929:web:0d4b062d7f2ab330fc1e78",
            measurementId: "G-SK0TJJEPF5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const docRef = doc(db, "quarters", "quarterId");
        const docSnap = await getDoc(docRef);
        const data = docSnap.data();
        const samples = data.samples;


        document.addEventListener('DOMContentLoaded', async function () {
            const quarterSelect = document.getElementById('quarter-select');
            const gameContainer = document.getElementById('game-container');
            const resultsContainer = document.getElementById('results');
            const resultContainer = document.getElementById('result-container');

            // Fetch all quarters and populate the dropdown
            const quartersSnapshot = await getDocs(collection(db, 'quarters'));
            quartersSnapshot.forEach((doc) => {
                const option = document.createElement('option');
                option.value = doc.id;
                option.text = doc.data().name;
                quarterSelect.appendChild(option);
            });

            quarterSelect.addEventListener('change', async function () {
                const quarterId = this.value;
                if (quarterId) {
                    const docRef = doc(db, 'quarters', quarterId);
                    const docSnap = await getDoc(docRef);

                    if (docSnap.exists()) {
                        const quarterData = docSnap.data();
                        gameContainer.innerHTML = ''; // Clear previous samples

                        quarterData.samples.forEach((sample, index) => {
                            gameContainer.appendChild(createSampleInput(sample, index));
                        });

                        document.querySelectorAll('input[type="range"]').forEach(slider => {
                            const valueDisplay = slider.nextElementSibling;
                            slider.addEventListener('input', () => {
                                valueDisplay.innerText = slider.value;
                            });
                        });
                    } else {
                        console.log("No such document!");
                    }
                } else {
                    gameContainer.innerHTML = ''; // Clear samples if no quarter is selected
                }
            });

            document.getElementById('submit-answers').addEventListener('click', () => {
                resultsContainer.innerHTML = '';
                let totalScore = 0;

                document.querySelectorAll('.sample').forEach((sampleDiv, index) => {
                    const mashbill = sampleDiv.querySelector('select').value;
                    const proof = sampleDiv.querySelector('input[type="range"]').value;
                    const age = sampleDiv.querySelector('input[type="range"]').value;

                    const actualSample = quarterData.samples[index];
                    let score = 0;

                    if (mashbill === actualSample.mashbill) score += 10;
                    score += 10 - Math.abs(proof - actualSample.proof);
                    score += 10 - Math.abs(age - actualSample.age);

                    totalScore += score;

                    const resultDiv = document.createElement('div');
                    resultDiv.innerText = `Sample ${index + 1}: ${score} points`;
                    resultsContainer.appendChild(resultDiv);
                });

                const totalScoreDiv = document.createElement('div');
                totalScoreDiv.innerText = `Total Score: ${totalScore} points`;
                resultsContainer.appendChild(totalScoreDiv);

                resultContainer.style.display = 'block';
            });

            function createSampleInput(sample, sampleIndex) {
                const sampleDiv = document.createElement('div');
                sampleDiv.classList.add('sample');

                const mashbillLabel = document.createElement('label');
                mashbillLabel.innerText = `Sample ${sampleIndex + 1} - Select Mashbill: `;
                const mashbillSelect = document.createElement('select');
                ['Bourbon', 'Rye', 'Wheat', 'Single Malt', 'Blend', 'Specialty'].forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.innerText = cat;
                    mashbillSelect.appendChild(option);
                });

                const proofLabel = document.createElement('label');
                proofLabel.innerText = 'Guess Proof: ';
                const proofSlider = document.createElement('input');
                proofSlider.type = 'range';
                proofSlider.min = '80';
                proofSlider.max = '130';
                const proofValue = document.createElement('span');
                proofSlider.addEventListener('input', () => proofValue.innerText = proofSlider.value);

                const ageLabel = document.createElement('label');
                ageLabel.innerText = 'Guess Age: ';
                const ageSlider = document.createElement('input');
                ageSlider.type = 'range';
                ageSlider.min = '1';
                ageSlider.max = '10';
                const ageValue = document.createElement('span');
                ageSlider.addEventListener('input', () => ageValue.innerText = ageSlider.value);

                sampleDiv.appendChild(mashbillLabel);
                sampleDiv.appendChild(mashbillSelect);
                sampleDiv.appendChild(document.createElement('br'));
                sampleDiv.appendChild(proofLabel);
                sampleDiv.appendChild(proofSlider);
                sampleDiv.appendChild(proofValue);
                sampleDiv.appendChild(document.createElement('br'));
                sampleDiv.appendChild(ageLabel);
                sampleDiv.appendChild(ageSlider);
                sampleDiv.appendChild(ageValue);

                return sampleDiv;
            }
        });
    </script>
</body>
</html>