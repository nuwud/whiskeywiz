<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiskey Challenge Admin</title>

    <!-- Firebase CDN Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getFirestore, collection, getDocs, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCqZMaGpJGf5veYgTXmytg1bLerva-of0U",
            authDomain: "whiskeywiz2.firebaseapp.com",
            databaseURL: "https://whiskeywiz2-default-rtdb.firebaseio.com",
            projectId: "whiskeywiz2",
            storageBucket: "whiskeywiz2.appspot.com",
            messagingSenderId: "555320797929",
            appId: "1:555320797929:web:0d4b062d7f2ab330fc1e78",
            measurementId: "G-SK0TJJEPF5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', () => {
            const quarterForm = document.getElementById('quarter-form');
            const samplesContainer = document.getElementById('samples-container');
            const quartersList = document.getElementById('quarters-list');

            function createSampleAnswerInputs(sampleIndex) {
                const sampleDiv = document.createElement('div');
                sampleDiv.classList.add('sample-answer');

                const mashbillLabel = document.createElement('label');
                mashbillLabel.innerText = `Sample ${sampleIndex + 1} - Mashbill: `;
                const mashbillInput = document.createElement('select');
                const categories = ['Bourbon', 'Rye', 'Wheat', 'Single Malt', 'Blend', 'Specialty'];
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.innerText = cat;
                    mashbillInput.appendChild(option);
                });

                const proofLabel = document.createElement('label');
                proofLabel.innerText = 'Proof: ';
                const proofSlider = document.createElement('input');
                proofSlider.type = 'range';
                proofSlider.min = '80';
                proofSlider.max = '130';
                proofSlider.value = '100';
                const proofValue = document.createElement('span');
                proofValue.innerText = '100';
                proofSlider.addEventListener('input', () => {
                    proofValue.innerText = proofSlider.value;
                });

                const ageLabel = document.createElement('label');
                ageLabel.innerText = 'Age: ';
                const ageSlider = document.createElement('input');
                ageSlider.type = 'range';
                ageSlider.min = '1';
                ageSlider.max = '10';
                ageSlider.value = '5';
                const ageValue = document.createElement('span');
                ageValue.innerText = '5';
                ageSlider.addEventListener('input', () => {
                    ageValue.innerText = ageSlider.value;
                });

                sampleDiv.appendChild(mashbillLabel);
                sampleDiv.appendChild(mashbillInput);
                sampleDiv.appendChild(document.createElement('br'));
                sampleDiv.appendChild(proofLabel);
                sampleDiv.appendChild(proofSlider);
                sampleDiv.appendChild(proofValue);
                sampleDiv.appendChild(document.createElement('br'));
                sampleDiv.appendChild(ageLabel);
                sampleDiv.appendChild(ageSlider);
                sampleDiv.appendChild(ageValue);

                return sampleDiv;
            }

            for (let i = 0; i < 4; i++) {
                samplesContainer.appendChild(createSampleAnswerInputs(i));
            }

            quarterForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const quarterName = document.getElementById('quarter-name').value.trim();
                const samples = [];
                document.querySelectorAll('.sample-answer').forEach((sampleDiv) => {
                    samples.push({
                        mashbill: sampleDiv.querySelector('select').value,
                        proof: sampleDiv.querySelector('input[type="range"]').value,
                        age: sampleDiv.querySelector('input[type="range"]').value
                    });
                });

                await setDoc(doc(db, 'quarters', quarterName), {
                    name: quarterName,
                    samples: samples
                });
                alert('Quarter saved successfully!');
            });

            async function fetchQuarters() {
                const quartersSnapshot = await getDocs(collection(db, 'quarters'));
                quartersSnapshot.forEach(doc => {
                    const quarterData = doc.data();
                    const quarterDiv = document.createElement('div');
                    quarterDiv.classList.add('quarter-item');
                    quarterDiv.innerHTML = `<strong>${quarterData.name}</strong>`;
                    quartersList.appendChild(quarterDiv);
                });
            }

            fetchQuarters();
        });
    </script>
    <link rel="stylesheet" href="admin.css">
</head>
<body>
    <div class="container">
        <h1>Admin - Whiskey Challenge</h1>
        <form id="quarter-form">
            <label for="quarter-name">Quarter Name:</label>
            <input type="text" id="quarter-name" required>
            <h3>Set Answers for 4 Samples:</h3>
            <div id="samples-container" class="sample-container"></div>
            <button type="submit">Save Quarter</button>
        </form>
        <div id="quarters-list"></div>
    </div>
</body>
</html>
