<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiskey Challenge Admin</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background-color: #f4f4f4;
        }

        h1,
        h2 {
            text-align: center;
        }

        form {
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .samples-container {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 20px;
        }

        .sample {
            /* Add your styles here */
        }
    </style>
</head>

<body>
    <h1>Admin - Whiskey Challenge</h1>
    <h2>Create or Edit Quarters</h2>

    <form id="quarter-form">
        <label for="quarter-name">Quarter Name:</label>
        <input type="month" id="quarter-name" required>
        <h3>Set Answers for 4 Samples:</h3>

        <div class="samples-container" id="samples-container">
            <!-- Add your input elements here -->
        </div>

        <button type="submit">Save Quarter</button>
    </form>

    <h2>Quarters List</h2>
    <div id="quarters-list"></div>

    <button id="download-player-page">Download Player Page</button>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getFirestore, doc, setDoc, getDocs, collection, deleteDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCqZMaGpJGf5veYgTXmytg1bLerva-of0U",
            authDomain: "whiskeywiz2.firebaseapp.com",
            databaseURL: "https://whiskeywiz2-default-rtdb.firebaseio.com",
            projectId: "whiskeywiz2",
            storageBucket: "whiskeywiz2.appspot.com",
            messagingSenderId: "555320797929",
            appId: "1:555320797929:web:0d4b062d7f2ab330fc1e78",
            measurementId: "G-SK0TJJEPF5"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', () => {
            const quarterForm = document.getElementById('quarter-form');
            const samplesContainer = document.getElementById('samples-container');
            const quarterNameInput = document.getElementById('quarter-name');
            const quartersList = document.getElementById('quarters-list');

            function createSampleAnswerInputs(sampleIndex) {
                const sampleDiv = document.createElement('div');
                sampleDiv.classList.add('sample-answer');

                const mashbillLabel = document.createElement('label');
                mashbillLabel.innerText = `Sample ${sampleIndex + 1} - Mashbill: `;
                const mashbillSelect = document.createElement('select');
                ['Bourbon', 'Rye', 'Wheat', 'Single Malt', 'Blend', 'Specialty'].forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.innerText = cat;
                    mashbillSelect.appendChild(option);
                });

                const proofLabel = document.createElement('label');
                proofLabel.innerText = 'Proof: ';
                const proofInput = document.createElement('input');
                proofInput.type = 'number';

                const ageLabel = document.createElement('label');
                ageLabel.innerText = 'Age: ';
                const ageInput = document.createElement('input');
                ageInput.type = 'number';

                sampleDiv.appendChild(mashbillLabel);
                sampleDiv.appendChild(mashbillSelect);
                sampleDiv.appendChild(document.createElement('br'));

                sampleDiv.appendChild(proofLabel);
                sampleDiv.appendChild(proofInput);
                sampleDiv.appendChild(document.createElement('br'));

                sampleDiv.appendChild(ageLabel);
                sampleDiv.appendChild(ageInput);
                sampleDiv.appendChild(document.createElement('br'));

                return sampleDiv;
            }

            for (let i = 0; i < 4; i++) {
                samplesContainer.appendChild(createSampleAnswerInputs(i));
            }

            quarterForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const quarterName = quarterNameInput.value.trim();
                const samples = [];

                document.querySelectorAll('.sample-answer').forEach((sampleDiv, index) => {
                    samples.push({
                        mashbill: sampleDiv.querySelector('select').value,
                        proof: sampleDiv.querySelector('input[type="number"]').value,
                        age: sampleDiv.querySelector('input[type="number"]').value
                    });
                });

                await setDoc(doc(db, 'quarters', quarterName), {
                    name: quarterName,
                    samples: samples
                });
                alert('Quarter saved successfully!');
                fetchQuarters();
            });

            async function fetchQuarters() {
                quartersList.innerHTML = '';
                const snapshot = await getDocs(collection(db, 'quarters'));
                snapshot.forEach((doc) => {
                    const quarterData = doc.data();
                    const quarterDiv = document.createElement('div');
                    quarterDiv.classList.add('quarter-row');
                    quarterDiv.innerHTML = `<strong>${quarterData.name}</strong> 
                                            <button onclick="editQuarter('${doc.id}')">Edit</button>
                                            <button onclick="deleteQuarter('${doc.id}')">Delete</button>`;
                    quartersList.appendChild(quarterDiv);
                });
            }

            window.editQuarter = async (quarterId) => {
                const docRef = doc(db, 'quarters', quarterId);
                const docSnap = await getDoc(docRef);
                if (docSnap.exists()) {
                    const quarterData = docSnap.data();
                    quarterNameInput.value = quarterData.name;
                    quarterData.samples.forEach((sample, index) => {
                        const sampleDiv = document.querySelectorAll('.sample-answer')[index];
                        sampleDiv.querySelector('select').value = sample.mashbill;
                        sampleDiv.querySelector('input[type="number"]').value = sample.proof;
                        sampleDiv.querySelector('input[type="number"]').value = sample.age;
                    });
                }
            };

            window.deleteQuarter = async (quarterId) => {
                await deleteDoc(doc(db, 'quarters', quarterId));
                alert('Quarter deleted successfully!');
                fetchQuarters();
            };

            // Trigger the download of the player page
            const downloadButton = document.getElementById('download-player-page');
            downloadButton.addEventListener('click', () => {
                const playerHtml = generatePlayerHtml();
                const blob = new Blob([playerHtml], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `${quarterNameInput.value}-player.html`;
                a.click();
                URL.revokeObjectURL(url);
            });

            fetchQuarters();
        });

        function generatePlayerHtml() {
            return `
            <!DOCTYPE html>
            <html lang="en">
            <head>
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <title>Whiskey Challenge - Player</title>
                <link rel="stylesheet" href="styles.css">
            </head>
            <body>
                <h1>Whiskey Challenge</h1>
                <div id="game-container"></div>
                <script>
                    const gameContainer = document.getElementById('game-container');
        
                    function createSampleInput(sampleIndex) {
                        const sampleDiv = document.createElement('div');
                        sampleDiv.classList.add('sample');
        
                        const mashbillLabel = document.createElement('label');
                        mashbillLabel.innerText = \`Sample \${sampleIndex + 1} - Select Mashbill: \`;
                        const mashbillSelect = document.createElement('select');
                        ['Bourbon', 'Rye', 'Wheat', 'Single Malt', 'Blend', 'Specialty'].forEach(cat => {
                            const option = document.createElement('option');
                            option.value = cat;
                            option.innerText = cat;
                            mashbillSelect.appendChild(option);
                        });
        
                        const proofLabel = document.createElement('label');
                        proofLabel.innerText = 'Guess Proof: ';
                        const proofSlider = document.createElement('input');
                        proofSlider.type = 'range';
                        proofSlider.min = '80';
                        proofSlider.max = '130';
                        const proofValue = document.createElement('span');
                        proofSlider.addEventListener('input', () => proofValue.innerText = proofSlider.value);
        
                        const ageLabel = document.createElement('label');
                        ageLabel.innerText = 'Guess Age: ';
                        const ageSlider = document.createElement('input');
                        ageSlider.type = 'range';
                        ageSlider.min = '1';
                        ageSlider.max = '10';
                        const ageValue = document.createElement('span');
                        ageSlider.addEventListener('input', () => ageValue.innerText = ageSlider.value);
        
                        sampleDiv.appendChild(mashbillLabel);
                        sampleDiv.appendChild(mashbillSelect);
                        sampleDiv.appendChild(document.createElement('br'));
                        sampleDiv.appendChild(proofLabel);
                        sampleDiv.appendChild(proofSlider);
                        sampleDiv.appendChild(proofValue);
                        sampleDiv.appendChild(document.createElement('br'));
                        sampleDiv.appendChild(ageLabel);
                        sampleDiv.appendChild(ageSlider);
                        sampleDiv.appendChild(ageValue);
        
                        return sampleDiv;
                    }
        
                    for (let i = 0; i < 4; i++) {
                        gameContainer.appendChild(createSampleInput(i));
                    }
        
                    // Add form submission logic here, including score calculation
                <\/script>
            </body>
            </html>`;
        }
    </script>
</body>

</html>