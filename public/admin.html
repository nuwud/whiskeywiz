<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Whiskey Challenge Admin</title>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js";
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCqZMaGpJGf5veYgTXmytg1bLerva-of0U",
            authDomain: "whiskeywiz2.firebaseapp.com",
            projectId: "whiskeywiz2",
            storageBucket: "whiskeywiz2.appspot.com",
            messagingSenderId: "555320797929",
            appId: "1:555320797929:web:0d4b062d7f2ab330fc1e78",
            measurementId: "G-SK0TJJEPF5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.addEventListener('DOMContentLoaded', function () {
            const quarterForm = document.getElementById('quarter-form');
            const samplesContainer = document.getElementById('samples-container');
            const quarterSelect = document.getElementById('quarter-select');
            const quartersList = document.getElementById('quarters-list');

            // Populate quarter options for past and future years
            const months = ['January', 'March', 'June', 'September', 'December'];
            const currentYear = new Date().getFullYear();
            for (let year = currentYear - 2; year <= currentYear + 10; year++) {
                months.forEach(month => {
                    const option = document.createElement('option');
                    option.value = `${month} ${year}`;
                    option.innerText = `${month} ${year}`;
                    quarterSelect.appendChild(option);
                });
            }

            // Function to create sample answer input fields
            function createSampleAnswerInputs(sampleIndex) {
                const sampleDiv = document.createElement('div');
                sampleDiv.classList.add('sample-answer');

                const mashbillLabel = document.createElement('label');
                mashbillLabel.innerText = `Sample ${sampleIndex + 1} - Mashbill: `;
                const mashbillSelect = document.createElement('select');
                const categories = ['Bourbon', 'Rye', 'Wheat', 'Single Malt', 'Blend', 'Specialty'];
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.innerText = cat;
                    mashbillSelect.appendChild(option);
                });

                const proofLabel = document.createElement('label');
                proofLabel.innerText = 'Proof: ';
                const proofInput = document.createElement('input');
                proofInput.type = 'range';
                proofInput.min = '80';
                proofInput.max = '130';
                proofInput.value = '100';
                const proofValue = document.createElement('span');
                proofValue.innerText = proofInput.value;
                proofInput.addEventListener('input', () => proofValue.innerText = proofInput.value);

                const ageLabel = document.createElement('label');
                ageLabel.innerText = 'Age: ';
                const ageInput = document.createElement('input');
                ageInput.type = 'range';
                ageInput.min = '1';
                ageInput.max = '10';
                ageInput.value = '5';
                const ageValue = document.createElement('span');
                ageValue.innerText = ageInput.value;
                ageInput.addEventListener('input', () => ageValue.innerText = ageInput.value);

                // Append elements stacked vertically inside each div
                sampleDiv.appendChild(mashbillLabel);
                sampleDiv.appendChild(mashbillSelect);
                sampleDiv.appendChild(proofLabel);
                sampleDiv.appendChild(proofInput);
                sampleDiv.appendChild(proofValue);
                sampleDiv.appendChild(ageLabel);
                sampleDiv.appendChild(ageInput);
                sampleDiv.appendChild(ageValue);

                return sampleDiv;
            }

            // Add sample input fields for answers, stack them next to each other
            for (let i = 0; i < 4; i++) {
                const column = document.createElement('div');
                column.classList.add('sample-column');
                column.appendChild(createSampleAnswerInputs(i));
                samplesContainer.appendChild(column);
            }

            // Submit form to save quarter
            quarterForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                const quarterName = quarterSelect.value.trim();
                const samples = [];

                // Gather sample answers
                document.querySelectorAll('.sample-answer').forEach((sampleDiv) => {
                    samples.push({
                        mashbill: sampleDiv.querySelector('select').value,
                        proof: sampleDiv.querySelector('input[type="range"]').value,
                        age: sampleDiv.querySelector('input[type="range"]').value
                    });
                });

                // Save quarter and sample answers to Firestore
                await setDoc(doc(db, 'quarters', quarterName), {
                    name: quarterName,
                    samples: samples
                });

                alert('Quarter saved successfully!');
                quarterForm.reset();
                fetchQuarters();
            });

            // Fetch and display quarters
            async function fetchQuarters() {
                const quartersSnapshot = await getDocs(collection(db, 'quarters'));
                quartersList.innerHTML = '';
                quartersSnapshot.forEach(doc => {
                    const quarterData = doc.data();
                    const quarterDiv = document.createElement('div');
                    quarterDiv.innerHTML = `<strong>${quarterData.name}</strong>`;
                    quartersList.appendChild(quarterDiv);
                });
            }

            fetchQuarters();
        });
    </script>

    <link rel="stylesheet" href="admin.css">
    <style>
        .sample-column {
            display: inline-block;
            margin-right: 20px;
        }

        .sample-answer {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
        }
    </style>
</head>

<body>
    <h1>Admin - Whiskey Challenge</h1>
    <h2>Create or Edit Quarters</h2>

    <form id="quarter-form">
        <label for="quarter-select">Select Quarter:</label>
        <select id="quarter-select" required></select>

        <h3>Set Answers for 4 Samples:</h3>
        <div id="samples-container" style="display: flex; justify-content: space-between;"></div>

        <button type="submit">Save Quarter</button>
    </form>

    <div id="quarters-list"></div>
</body>

</html>
